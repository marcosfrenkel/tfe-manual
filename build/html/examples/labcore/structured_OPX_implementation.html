

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to Use OPX Sweeping &mdash; Tools for Experiments Manual  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Basic Operation of DDH5 and Benchmarking" href="../plottr/Basic%20operation%20of%20DDH5%20and%20benchmarking.html" />
    <link rel="prev" title="Sweep Guide" href="Introduction%20to%20sweeping.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Tools for Experiments Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../plottr/index.html">Plottr’s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labcore/index.html">Labcore’s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instrumentserver/index.html">Instrumentserver’s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Index Page</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples and Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general">General</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#labcore">Labcore</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Introduction%20to%20sweeping.html">Sweep Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to Use OPX Sweeping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Imports">Imports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Base-Decorator">Base Decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Raw-Value-DataSpec">Raw Value DataSpec</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Specific-OPX-Implementation">Specific OPX Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Proposal-for-Base-Running-and-Saving">Proposal for Base Running and Saving</a></li>
<li class="toctree-l4"><a class="reference internal" href="#QUA-experiment-with-implemented-decorator">QUA experiment with implemented decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Notes">Notes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plotrr">Plotrr</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Tools for Experiments Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Examples and Guides</a> &raquo;</li>
        
      <li>How to Use OPX Sweeping</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/examples/labcore/structured_OPX_implementation.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="How-to-Use-OPX-Sweeping">
<h1>How to Use OPX Sweeping<a class="headerlink" href="#How-to-Use-OPX-Sweeping" title="Permalink to this headline">¶</a></h1>
<section id="Imports">
<h2>Imports<a class="headerlink" href="#Imports" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">qcodes</span> <span class="k">as</span> <span class="nn">qc</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">labcore.measurement</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">configuration</span> <span class="kn">import</span> <span class="n">QMConfig</span>
<span class="kn">from</span> <span class="nn">qm.qua</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qm.QuantumMachinesManager</span> <span class="kn">import</span> <span class="n">QuantumMachinesManager</span>

<span class="kn">from</span> <span class="nn">plottr.data</span> <span class="kn">import</span> <span class="n">datadict_storage</span> <span class="k">as</span> <span class="n">dds</span><span class="p">,</span> <span class="n">datadict</span> <span class="k">as</span> <span class="n">dd</span>

<span class="c1"># global module variable for the config file</span>
<span class="n">global_config</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</section>
<section id="Base-Decorator">
<h2>Base Decorator<a class="headerlink" href="#Base-Decorator" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">BackgroundRecordingBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class decorator used to record asynchronous data from instrument.</span>
<span class="sd">    Use the decorator with create_background_sweep function to create Sweeps that collect asynchronous data from</span>
<span class="sd">    external devices running experiments independently of the measurement PC,</span>
<span class="sd">    e.i. the measuring happening is not being controlled by a Sweep but instead an external device (e.g. the OPX).</span>
<span class="sd">    Each instrument should have its own custom setup_wrapper (see setup_wrapper docstring for more info),</span>
<span class="sd">    and a custom collector.</span>
<span class="sd">    Auxiliary functions for the start_wrapper and collector should also be located in this class.</span>

<span class="sd">    :param *specs: A list of the DataSpecs to record the data produced.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">specs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span> <span class="o">=</span> <span class="n">specs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the decorator is called the experiment function gets wrapped so that it returns an Sweep object composed</span>
<span class="sd">        of 2 different Sweeps, the setup sweep and the collector Sweep.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">sweep</span><span class="p">(</span><span class="o">**</span><span class="n">collector_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sweep</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns a Sweep comprised of 2 different Sweeps: start_sweep and collector_sweep.</span>
<span class="sd">            start_sweep should perform any setup actions as well as starting the actual experiment. This sweep is only</span>
<span class="sd">            executed once. collector_sweep is iterated multiple time to collect all the data generated from the</span>
<span class="sd">            instrument.</span>

<span class="sd">            :param collector_kwargs: Any arguments that the collector needs.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">start_sweep</span> <span class="o">=</span> <span class="n">once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_wrapper</span><span class="p">(</span><span class="n">fun</span><span class="p">))</span>
            <span class="n">collector_sweep</span> <span class="o">=</span> <span class="n">Sweep</span><span class="p">(</span><span class="n">record_as</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="p">(</span><span class="o">**</span><span class="n">collector_kwargs</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">start_sweep</span> <span class="o">+</span> <span class="n">collector_sweep</span>

        <span class="k">return</span> <span class="n">sweep</span>

    <span class="k">def</span> <span class="nf">start_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wraps the start function. setup_wrapper should consist of another function inside of it decorated with @wraps</span>
<span class="sd">        with fun as its argument.</span>
<span class="sd">        In this case the wrapped function is setup.</span>
<span class="sd">        Setup should accept the *args and **kwargs of fun. It should also place any returns from fun in the communicator.</span>
<span class="sd">        setup_wrapper needs to return the wrapped function (setup)</span>

<span class="sd">        :param fun: The measurement function. In the case of the OPX this would be the function that returns the QUA</span>
<span class="sd">                    code with any arguments that it might use.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Starts the experiment and saves anything that the collector needs from the startup of the measurement in the</span>
<span class="sd">            collector dictionary.</span>

<span class="sd">            :param args: Any args that fun needs.</span>
<span class="sd">            :param kwargs: Any kwargs that fun needs.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;setup_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">start</span>

    <span class="k">def</span> <span class="nf">collector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data collection generator. The generator should contain all the logic of waiting for the asynchronous data.</span>
<span class="sd">        Its should yield a dictionary with the name of the of the DataSpecs as keywords and numpy arrays with the values</span>
<span class="sd">        collected from the instrument. The generator should exhaust itself once all the data produced by the</span>
<span class="sd">        measurement has been generated</span>

<span class="sd">        :param kwargs: Any kwargs necessary for the specific implementation of the collector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">yield</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">create_background_sweep</span><span class="p">(</span><span class="n">decorated_measurement_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">**</span><span class="n">collector_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sweep</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the Sweep object from a measurement function decorated with any implementation of BackgroundRecordingBase.</span>

<span class="sd">    :param decorated_measurement_function: Measurement function decorated with</span>
<span class="sd">                                           a BackgroundRecordingBase class decorator.</span>
<span class="sd">    :param collector_kwargs: Any kwargs that the collector needs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sweep</span> <span class="o">=</span> <span class="n">decorated_measurement_function</span><span class="p">(</span><span class="o">**</span><span class="n">collector_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sweep</span>

</pre></div>
</div>
</div>
</section>
<section id="Raw-Value-DataSpec">
<h2>Raw Value DataSpec<a class="headerlink" href="#Raw-Value-DataSpec" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">raw_OPX_data</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">depends_on</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">type_var</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span><span class="p">):</span>
    <span class="n">indep_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_time&#39;</span>
    <span class="n">indep</span> <span class="o">=</span> <span class="n">independent</span><span class="p">(</span><span class="n">indep_name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">type_var</span><span class="p">)</span>
    <span class="n">depends_on</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indep_name</span><span class="p">)</span>
    <span class="n">dep</span> <span class="o">=</span> <span class="n">dependent</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">depends_on</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">type_var</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">name</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</section>
<section id="Specific-OPX-Implementation">
<h2>Specific OPX Implementation<a class="headerlink" href="#Specific-OPX-Implementation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">RecordOPX</span><span class="p">(</span><span class="n">BackgroundRecordingBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of BackgroundRecordingBase for use with the OPX machine.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">specs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;raw_variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten_and_sort_dataspecs</span><span class="p">(</span><span class="n">specs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_flatten_and_sort_dataspecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">DataSpec</span><span class="p">):</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;raw_variables&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rec_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_and_sort_dataspecs</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rec_list</span><span class="p">:</span>
                            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">start_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start_wrapper for the OPX machine. Wraps the startup function.</span>
<span class="sd">        Returns the actual startup function to be executed when the sweep is iterated through.</span>

<span class="sd">        :param fun: Function that returns the QUA program.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Establishes connection with the OPX and starts the the measurement. The config of the OPX is passed through</span>
<span class="sd">            the module variable global_config. It saves the result handles and saves initial values to the communicator</span>
<span class="sd">            dictionary.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Start the measurement in the OPX.</span>
            <span class="n">qmachine_mgr</span> <span class="o">=</span> <span class="n">QuantumMachinesManager</span><span class="p">()</span>
            <span class="n">qmachine</span> <span class="o">=</span> <span class="n">qmachine_mgr</span><span class="o">.</span><span class="n">open_qm</span><span class="p">(</span><span class="n">global_config</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">qmachine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="n">result_handles</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result_handles</span>

            <span class="c1"># Save the result handle and create initial parameters in the communicator used in the collector.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;result_handles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_handles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">startup</span>

    <span class="k">def</span> <span class="nf">_wait_for_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batchsize</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for the opx to have measured more data points than the ones indicated in the batchsize. Also checks that</span>
<span class="sd">        the OPX is still collecting data, when the OPX is no longer processing, turn communicator[&#39;active&#39;] to False to</span>
<span class="sd">        exhaust the collector.</span>

<span class="sd">        :param batchsize: Size of batch. How many data-points is the minimum for the sweep to get in an iteration.</span>
<span class="sd">                          e.g. if 5, _control_progress will keep running until at least 5 new data-points</span>
<span class="sd">                          are available for collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># When ready becomes True, the infinite loop stops.</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Collect necessary values from communicator.</span>
        <span class="n">res_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;result_handles&#39;</span><span class="p">]</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">ready</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">res_handle</span><span class="p">:</span>

                <span class="n">current_datapoint</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">count_so_far</span><span class="p">()</span>

                <span class="c1"># Check if the OPX is still processing.</span>
                <span class="k">if</span> <span class="n">res_handle</span><span class="o">.</span><span class="n">is_processing</span><span class="p">():</span>
                    <span class="c1"># Check if enough data-points are available.</span>
                    <span class="k">if</span> <span class="n">current_datapoint</span> <span class="o">-</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="n">batchsize</span><span class="p">:</span>
                        <span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Once the OPX is done processing turn ready True and turn active False to exhaust the generator.</span>
                    <span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>


    <span class="k">def</span> <span class="nf">collector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batchsize</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of collector for the OPX. Collects new data-points from the OPX and yields them in a dictionary</span>
<span class="sd">        with the names of the recorded variables as keywords and numpy arrays with the values. Raises ValueError if a</span>
<span class="sd">        stream name inside the QUA program has a different name than a recorded variable and if the amount of recorded</span>
<span class="sd">        variables and streams are different.</span>

<span class="sd">        :param batchsize: Size of batch. How many data-points is the minimum for the sweep to get in an iteration.</span>
<span class="sd">                          e.g. if 5, _control_progress will keep running until at least 5 new data-points</span>
<span class="sd">                          are available for collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get the result_handles from the communicator.</span>
        <span class="n">result_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;result_handles&#39;</span><span class="p">]</span>

        <span class="c1"># Get the names of all variables from the specs.</span>
        <span class="n">data_specs_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_values_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;raw_variables&#39;</span><span class="p">])</span>

        <span class="n">data_specs_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">]</span>
        <span class="n">variable_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">result_handle</span><span class="p">:</span>

            <span class="c1"># Check that the stream names are present in the DataSpecs.</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_specs_names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> is not a recorded variable&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">variable_counter</span> <span class="o">+=</span> <span class="mi">1</span>


        <span class="c1"># Check that the number of recorded variables and streams are the same.</span>
        <span class="k">if</span> <span class="n">variable_counter</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_specs_names</span><span class="p">)</span> <span class="o">-</span> <span class="n">raw_values_count</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of recorded variables (</span><span class="si">{</span><span class="n">variable_counter</span><span class="si">}</span><span class="s1">) </span><span class="se">\</span>
<span class="s1">                             does not match number of variables gathered from the OPX (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data_specs_names</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>


        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">]:</span>
            <span class="c1"># Restart values for each iteration.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span>  <span class="c1"># Previous iteration data-point number.</span>
            <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Make sure that the result_handle is active.</span>
            <span class="k">if</span> <span class="n">result_handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="kc">None</span>

            <span class="c1"># Waits until new data-points are ready to be gathered.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_data</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">result_handle</span><span class="p">:</span>

                <span class="c1"># To ensure that we get the same number of data-points from every variable only get the current count</span>
                <span class="c1"># for the first variable in the stream.</span>
                <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">count_so_far</span><span class="p">()</span>  <span class="c1"># Current data-point number</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="c1"># if the current data-point number is the same as the previous data-point number, no new data</span>
                    <span class="c1"># has been gathered.</span>
                    <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">counter</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="kc">None</span>
                        <span class="k">break</span>

                <span class="c1"># Make sure that the OPX has actually measured the current value for all variables and fetch the</span>
                <span class="c1"># new data lines.</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">wait_for_values</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="n">data_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">current</span><span class="p">)))</span>

                <span class="c1"># If the trace is a raw measurement, we need to go through its shape to properly convert it</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;raw_variables&#39;</span><span class="p">]:</span>
                    <span class="n">holding_converting</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data_temp</span><span class="p">:</span>
                        <span class="n">i_holder</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">converted</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                            <span class="n">i_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converted</span><span class="p">)</span>
                        <span class="n">holding_converting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_holder</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">holding_converting</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">converted_data_temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">holding_converting</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">converted_data_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">holding_converting</span><span class="p">)</span>

                    <span class="n">raw_count</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;repetition&#39;</span><span class="p">])):</span>
                        <span class="n">raw_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">converted_data_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_count</span>


                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># data comes from the OPX as numpy.void. Converts array to contain floats instead.</span>
                    <span class="n">converted_data_temp</span> <span class="o">=</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>


                <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">converted_data_temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicator</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
            <span class="k">yield</span> <span class="n">data</span>
</pre></div>
</div>
</div>
</section>
<section id="Proposal-for-Base-Running-and-Saving">
<h2>Proposal for Base Running and Saving<a class="headerlink" href="#Proposal-for-Base-Running-and-Saving" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">_create_datadict_structure</span><span class="p">(</span><span class="n">sweep</span><span class="p">:</span> <span class="n">Sweep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dd</span><span class="o">.</span><span class="n">DataDict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a structured DataDict from the DataSpecs of a Sweep.</span>

<span class="sd">    :param sweep: Sweep object from which the DataDict is created.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_specs</span> <span class="o">=</span> <span class="n">sweep</span><span class="o">.</span><span class="n">get_data_specs</span><span class="p">()</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">DataDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">data_specs</span><span class="p">:</span>

        <span class="n">depends_on</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">depends_on</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Checks which fields have information and which ones are None.</span>
        <span class="k">if</span> <span class="n">depends_on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">depends_on</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">depends_on</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

    <span class="n">data_dict</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">data_dict</span>


<span class="k">def</span> <span class="nf">_check_none</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the values in a Dict are all None. Returns True if all values are None, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">run_and_save_sweep</span><span class="p">(</span><span class="n">sweep</span><span class="p">:</span> <span class="n">Sweep</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates through a sweep, saving the data coming through it into a file called &lt;name&gt; at &lt;data_dir&gt; directory.</span>

<span class="sd">    :param sweep: Sweep object to iterate through.</span>
<span class="sd">    :param data_dir: Directory of file location</span>
<span class="sd">    :param name: name of the file</span>
<span class="sd">    :param prt: Bool, if True, the function will print every result coming from the sweep. Default, False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="n">_create_datadict_structure</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span>

    <span class="c1"># Creates a file even when it fails.</span>
    <span class="k">with</span> <span class="n">dds</span><span class="o">.</span><span class="n">DDH5Writer</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sweep</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_none</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">prt</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="n">writer</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="o">**</span><span class="n">line</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The measurement has finished successfully and all of the data has been saved.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="QUA-experiment-with-implemented-decorator">
<h2>QUA experiment with implemented decorator<a class="headerlink" href="#QUA-experiment-with-implemented-decorator" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nd">@RecordOPX</span><span class="p">(</span>
        <span class="n">dependent</span><span class="p">(</span><span class="s1">&#39;tracker&#39;</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;repetition&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">),</span>
        <span class="n">independent</span><span class="p">(</span><span class="s1">&#39;repetition&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">),</span>
        <span class="n">raw_OPX_data</span><span class="p">(</span><span class="s1">&#39;data_raw&#39;</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;repetition&#39;</span><span class="p">],</span> <span class="n">type_var</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">),</span>
        <span class="n">dependent</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;repetition&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">my_qua_experiment</span><span class="p">(</span><span class="n">n_reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">program</span><span class="p">()</span> <span class="k">as</span> <span class="n">qua_measurement</span><span class="p">:</span>
        <span class="n">raw_stream</span> <span class="o">=</span> <span class="n">declare_stream</span><span class="p">(</span><span class="n">adc_trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">v_stream</span> <span class="o">=</span> <span class="n">declare_stream</span><span class="p">()</span>
        <span class="n">tracker_stream</span> <span class="o">=</span> <span class="n">declare_stream</span><span class="p">()</span>
        <span class="n">i_stream</span> <span class="o">=</span> <span class="n">declare_stream</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
        <span class="n">tracker</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">for_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n_reps</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">save</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i_stream</span><span class="p">)</span>

            <span class="n">measure</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;readout&#39;</span><span class="p">,</span> <span class="n">raw_stream</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;box_sin&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
            <span class="n">save</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_stream</span><span class="p">)</span>

            <span class="n">assign</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">tracker</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">save</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">tracker_stream</span><span class="p">)</span>

            <span class="n">play</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s2">&quot;readout&quot;</span><span class="p">)</span>
            <span class="n">wait</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">stream_processing</span><span class="p">():</span>
            <span class="n">i_stream</span><span class="o">.</span><span class="n">save_all</span><span class="p">(</span><span class="s1">&#39;repetition&#39;</span><span class="p">)</span>
            <span class="n">v_stream</span><span class="o">.</span><span class="n">save_all</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
            <span class="n">tracker_stream</span><span class="o">.</span><span class="n">save_all</span><span class="p">(</span><span class="s1">&#39;tracker&#39;</span><span class="p">)</span>
            <span class="n">raw_stream</span><span class="o">.</span><span class="n">input1</span><span class="p">()</span><span class="o">.</span><span class="n">save_all</span><span class="p">(</span><span class="s1">&#39;data_raw&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">qua_measurement</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DATADIR</span> <span class="o">=</span> <span class="s1">&#39;./data/&#39;</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">QMConfig</span><span class="p">()</span>
<span class="n">global_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>

<span class="n">sweep</span> <span class="o">=</span> <span class="n">create_background_sweep</span><span class="p">(</span><span class="n">my_qua_experiment</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sweep</span><span class="o">.</span><span class="n">set_action_opts</span><span class="p">(</span>
    <span class="n">my_qua_experiment</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">n_reps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sweep</span><span class="o">.</span><span class="n">get_data_specs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(tracker(repetition),
 repetition,
 data_raw_time,
 data_raw(repetition, data_raw_time),
 V(repetition))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">run_and_save_sweep</span><span class="p">(</span><span class="n">sweep</span><span class="p">,</span> <span class="n">DATADIR</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;OPX test data&#39;</span><span class="p">,</span> <span class="n">prt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data location:  ./data/2021-08-11\2021-08-11_0003_OPX test data\2021-08-11_0003_OPX test data.ddh5
2021-08-11 14:00:41,414 - qm - INFO - Performing health check
2021-08-11 14:00:41,416 - qm - INFO - Health check passed
2021-08-11 14:00:41,701 - qm - INFO - Flags:
2021-08-11 14:00:41,701 - qm - INFO - Executing high level program
{&#39;tracker&#39;: array([ 2.,  4.,  6.,  8., 10., 12., 14., 16., 18.]), &#39;repetition&#39;: array([0., 1., 2., 3., 4., 5., 6., 7., 8.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-75., -72., -76., ..., -76., -74., -74.],
       [-72., -77., -72., ..., -73., -73., -74.],
       [-76., -76., -76., ..., -74., -75., -73.],
       ...,
       [-73., -75., -75., ..., -74., -73., -72.],
       [-74., -76., -77., ..., -73., -74., -76.],
       [-74., -75., -72., ..., -75., -71., -70.]]), &#39;V&#39;: array([-0.19566366, -0.19560352, -0.19564379, -0.19560722, -0.19562164,
       -0.19560701, -0.19560337, -0.19555197, -0.19558788])}
{&#39;tracker&#39;: array([20., 22., 24., 26., 28., 30., 32., 34., 36., 38., 40., 42., 44.,
       46., 48.]), &#39;repetition&#39;: array([ 9., 10., 11., 12., 13., 14., 15., 16., 17., 18., 19., 20., 21.,
       22., 23.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-74., -74., -76., ..., -75., -75., -74.],
       [-73., -73., -73., ..., -72., -76., -73.],
       [-76., -72., -76., ..., -72., -76., -73.],
       ...,
       [-75., -73., -73., ..., -73., -76., -75.],
       [-72., -75., -74., ..., -73., -73., -73.],
       [-73., -76., -75., ..., -77., -76., -72.]]), &#39;V&#39;: array([-0.19558143, -0.19562206, -0.19562493, -0.19561273, -0.19560676,
       -0.19558093, -0.19558612, -0.19557469, -0.19559685, -0.1955983 ,
       -0.19557272, -0.19557101, -0.19559106, -0.1955911 , -0.19560567])}
{&#39;tracker&#39;: array([50., 52., 54., 56., 58., 60., 62., 64., 66., 68., 70., 72., 74.,
       76., 78.]), &#39;repetition&#39;: array([24., 25., 26., 27., 28., 29., 30., 31., 32., 33., 34., 35., 36.,
       37., 38.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-75., -73., -75., ..., -75., -72., -72.],
       [-74., -77., -77., ..., -74., -73., -74.],
       [-76., -75., -75., ..., -73., -73., -72.],
       ...,
       [-74., -73., -75., ..., -74., -77., -75.],
       [-75., -75., -74., ..., -71., -74., -73.],
       [-74., -74., -72., ..., -74., -75., -75.]]), &#39;V&#39;: array([-0.19564248, -0.19560193, -0.19561182, -0.19558174, -0.1956272 ,
       -0.19561709, -0.19560194, -0.19558607, -0.19560267, -0.19559168,
       -0.19556864, -0.19558342, -0.19559875, -0.1955734 , -0.19555813])}
{&#39;tracker&#39;: array([ 80.,  82.,  84.,  86.,  88.,  90.,  92.,  94.,  96.,  98., 100.,
       102., 104., 106., 108.]), &#39;repetition&#39;: array([39., 40., 41., 42., 43., 44., 45., 46., 47., 48., 49., 50., 51.,
       52., 53.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-72., -73., -75., ..., -75., -76., -76.],
       [-73., -73., -73., ..., -72., -73., -75.],
       [-74., -75., -74., ..., -72., -73., -73.],
       ...,
       [-72., -73., -75., ..., -73., -75., -73.],
       [-72., -76., -74., ..., -73., -73., -75.],
       [-72., -76., -74., ..., -73., -73., -72.]]), &#39;V&#39;: array([-0.19558992, -0.19557901, -0.19556065, -0.19557237, -0.1955826 ,
       -0.19556537, -0.19555499, -0.19556924, -0.19559754, -0.19558429,
       -0.19558922, -0.19557114, -0.19559921, -0.19557048, -0.19557459])}
{&#39;tracker&#39;: array([110., 112., 114., 116., 118., 120., 122., 124., 126., 128., 130.,
       132., 134.]), &#39;repetition&#39;: array([54., 55., 56., 57., 58., 59., 60., 61., 62., 63., 64., 65., 66.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-74., -76., -73., ..., -73., -72., -75.],
       [-72., -75., -74., ..., -73., -73., -74.],
       [-75., -73., -72., ..., -74., -74., -74.],
       ...,
       [-73., -74., -73., ..., -72., -73., -74.],
       [-74., -72., -75., ..., -74., -73., -72.],
       [-72., -74., -74., ..., -73., -73., -75.]]), &#39;V&#39;: array([-0.19558999, -0.19556257, -0.19557427, -0.19557695, -0.19557413,
       -0.19557659, -0.19556152, -0.1955514 , -0.19555844, -0.19553477,
       -0.19557517, -0.19556775, -0.19558122])}
{&#39;tracker&#39;: array([136., 138., 140., 142., 144., 146., 148., 150., 152., 154., 156.,
       158., 160., 162., 164.]), &#39;repetition&#39;: array([67., 68., 69., 70., 71., 72., 73., 74., 75., 76., 77., 78., 79.,
       80., 81.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-74., -76., -72., ..., -72., -73., -75.],
       [-77., -73., -72., ..., -74., -75., -74.],
       [-74., -74., -75., ..., -74., -71., -75.],
       ...,
       [-74., -73., -73., ..., -73., -70., -72.],
       [-74., -74., -76., ..., -75., -73., -75.],
       [-76., -74., -75., ..., -74., -75., -75.]]), &#39;V&#39;: array([-0.19559484, -0.19562735, -0.19564427, -0.19562278, -0.1956171 ,
       -0.19561729, -0.19557353, -0.19560364, -0.19558658, -0.19558943,
       -0.19558396, -0.1956337 , -0.1955747 , -0.19558817, -0.19561692])}
{&#39;tracker&#39;: array([166., 168., 170., 172., 174., 176., 178., 180., 182., 184., 186.,
       188., 190., 192., 194.]), &#39;repetition&#39;: array([82., 83., 84., 85., 86., 87., 88., 89., 90., 91., 92., 93., 94.,
       95., 96.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-75., -74., -74., ..., -75., -77., -72.],
       [-74., -73., -75., ..., -72., -70., -74.],
       [-73., -73., -73., ..., -74., -71., -74.],
       ...,
       [-74., -73., -76., ..., -74., -74., -70.],
       [-73., -74., -71., ..., -77., -73., -72.],
       [-72., -74., -71., ..., -75., -72., -71.]]), &#39;V&#39;: array([-0.19561243, -0.19561542, -0.19559122, -0.19558846, -0.19563644,
       -0.19559987, -0.19558939, -0.19560616, -0.19560388, -0.19561871,
       -0.19564744, -0.1956533 , -0.19564096, -0.19560597, -0.19558768])}
{&#39;tracker&#39;: array([196., 198., 200.]), &#39;repetition&#39;: array([97., 98., 99.]), &#39;data_raw_time&#39;: [array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999]), array([   0,    1,    2, ..., 9997, 9998, 9999])], &#39;data_raw&#39;: array([[-73., -75., -76., ..., -70., -74., -73.],
       [-74., -73., -75., ..., -73., -72., -75.],
       [-73., -75., -76., ..., -73., -73., -76.]]), &#39;V&#39;: array([-0.195613  , -0.1955915 , -0.19560177])}
The measurement has finished successfully and all of the data has been saved.
</pre></div></div>
</div>
</section>
<section id="Notes">
<h2>Notes<a class="headerlink" href="#Notes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The run_and_save function should work with any sweep, so that could be added to the general labcore package.</p></li>
<li><p>If a measurement fails to be executed, the writter still creates a file but the file is corrupted and plottr jsut raises a warning.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../plottr/Basic%20operation%20of%20DDH5%20and%20benchmarking.html" class="btn btn-neutral float-right" title="Basic Operation of DDH5 and Benchmarking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Introduction%20to%20sweeping.html" class="btn btn-neutral float-left" title="Sweep Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Wolfgang Pfaff, Marcos Frenkel.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>