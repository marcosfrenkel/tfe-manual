

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Nodes and Flowcharts &mdash; Tools for Experiments Manual  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Predefined nodes" href="../nodes/index.html" />
    <link rel="prev" title="Data formats" href="data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Tools for Experiments Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plottr’s Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Elementary concepts</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="data.html">Data formats</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Nodes and Flowcharts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contents">Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-flowcharts">Setting up flowcharts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-custom-nodes">Creating custom nodes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nodes/index.html">Predefined nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plotnode.html">Plotting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../labcore/index.html">Labcore’s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instrumentserver/index.html">Instrumentserver’s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Index Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples and Guides</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Tools for Experiments Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Plottr’s Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Elementary concepts</a> &raquo;</li>
        
      <li>Nodes and Flowcharts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/plottr/concepts/nodes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="nodes-and-flowcharts">
<h1>Nodes and Flowcharts<a class="headerlink" href="#nodes-and-flowcharts" title="Permalink to this headline">¶</a></h1>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-flowcharts">Setting up flowcharts</a></p></li>
<li><p><a class="reference internal" href="#create-you-own-nodes">Create you own nodes</a></p></li>
</ul>
<p>The basic concept of modular data analyis as we use it in plottr consists of <cite>Nodes</cite> that are connected directionally to form a <cite>Flowchart</cite>. This terminology is adopted from the great <a class="reference external" href="http://www.pyqtgraph.org">pyqtgraph</a> project; we currently use their <cite>Node</cite> and <cite>Flowchart</cite> API under the hood as well. Executing the flowchart means that data flows through the nodes via connections that have been made between them, and gets modified in some way by each node along the way. The end product is then the fully processed data. This whole process is typically on-demand: If a modification of the data flow occurs somewhere in the flowchart – e.g., due to user input – then only ‘downstream’ nodes need to re-process data in order to keep the flowchart output up to date.</p>
</section>
<section id="setting-up-flowcharts">
<span id="id1"></span><h2>Setting up flowcharts<a class="headerlink" href="#setting-up-flowcharts" title="Permalink to this headline">¶</a></h2>
<p>TBD.</p>
</section>
<section id="creating-custom-nodes">
<span id="create-you-own-nodes"></span><h2>Creating custom nodes<a class="headerlink" href="#creating-custom-nodes" title="Permalink to this headline">¶</a></h2>
<p>The following are some general notes. For an example see the notebook <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">nodes</span></code> under <code class="docutils literal notranslate"><span class="pre">doc/examples</span></code>.</p>
<p>The class <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node" title="plottr.node.node.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">plottr.node.node.Node</span></code></a> forms the basis for all nodes in plottr. It is an extension of <code class="docutils literal notranslate"><span class="pre">pyqtgraph</span></code>’s Node class with some additional tools, and  defaults.</p>
<section id="basics">
<h3>Basics:<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h3>
<p>The actual data processing the node is supposed to do is implemented in <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node.process" title="plottr.node.node.Node.process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.Node.process()</span></code></a>.</p>
</section>
<section id="defaults">
<h3>Defaults:<a class="headerlink" href="#defaults" title="Permalink to this headline">¶</a></h3>
<p>Per default, we use an input terminal (<code class="docutils literal notranslate"><span class="pre">dataIn</span></code>), and one output terminal (<code class="docutils literal notranslate"><span class="pre">dataOut</span></code>). Can be overwritten via the attribute <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node.terminals" title="plottr.node.node.Node.terminals"><code class="xref py py-attr docutils literal notranslate"><span class="pre">plottr.node.node.Node.terminals</span></code></a>.</p>
</section>
<section id="user-options">
<h3>User options:<a class="headerlink" href="#user-options" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal notranslate"><span class="pre">property</span></code> for user options. i.e., we implement a setter and getter function (e.g., with the <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorator). The setter can be decorated with <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.updateOption" title="plottr.node.node.updateOption"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.updateOption()</span></code></a> to automatically process the option change on assignment.</p>
</section>
<section id="synchronizing-node-and-ui">
<h3>Synchronizing Node and UI:<a class="headerlink" href="#synchronizing-node-and-ui" title="Permalink to this headline">¶</a></h3>
<p>The UI widget is automatically instantiated when <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node.uiClass" title="plottr.node.node.Node.uiClass"><code class="xref py py-attr docutils literal notranslate"><span class="pre">plottr.node.node.Node.uiClass</span></code></a> is set to an appropriate node widget class, and <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node.useUi" title="plottr.node.node.Node.useUi"><code class="xref py py-attr docutils literal notranslate"><span class="pre">plottr.node.node.Node.useUi</span></code></a> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>Messaging between Node and Node UI is implemented through Qt signals/slots. Any update to a node property is signalled automatically when the property setter is decorated with <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.updateOption" title="plottr.node.node.updateOption"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.updateOption()</span></code></a>. A setter decorated with <code class="docutils literal notranslate"><span class="pre">&#64;updateOption('myOption')</span></code> will, on assignment of the new value, call the function assigned to <code class="docutils literal notranslate"><span class="pre">plottr.node.node.NodeWidget.optSetter['myOption']</span></code>.</p>
<p>Vice versa, there are tools to notify the node of changes made through the UI. Any trigger (such as a widget signal) can be connected to the UI by calling the functions <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.NodeWidget.signalOption" title="plottr.node.node.NodeWidget.signalOption"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.NodeWidget.signalOption()</span></code></a> with the option name (say, <code class="docutils literal notranslate"><span class="pre">myOption</span></code>) as argument, or <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.NodeWidget.signalAllOptions" title="plottr.node.node.NodeWidget.signalAllOptions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.NodeWidget.signalAllOptions()</span></code></a>. In the first case, the value of the option is taken by calling <code class="docutils literal notranslate"><span class="pre">plottr.node.node.NodeWidget.optGetter['myOption']()</span></code>, and then the name of the option and that value are emitted through <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.updateGuiFromNode" title="plottr.node.node.updateGuiFromNode"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.updateGuiFromNode()</span></code></a>; this is connected to <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node.setOption" title="plottr.node.node.Node.setOption"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.Node.setOption()</span></code></a> by default. Similarly, <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.NodeWidget.signalAllOptions" title="plottr.node.node.NodeWidget.signalAllOptions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.NodeWidget.signalAllOptions()</span></code></a> results in a signal leading to <a class="reference internal" href="../../api/plottr/node.html#plottr.node.node.Node.setOptions" title="plottr.node.node.Node.setOptions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plottr.node.node.Node.setOptions()</span></code></a>.</p>
<p>The implementation of the suitable triggers for emitting the option value and assigning functions to entries in <code class="docutils literal notranslate"><span class="pre">optSetters</span></code> and <code class="docutils literal notranslate"><span class="pre">optGetters</span></code> is up to the re-implementation.</p>
</section>
<section id="example-implementation">
<h3>Example implementation:<a class="headerlink" href="#example-implementation" title="Permalink to this headline">¶</a></h3>
<p>The implementation of a custom node with GUI can then looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>

    <span class="n">useUi</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">uiClass</span> <span class="o">=</span> <span class="n">MyNodeGui</span>

    <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">myOption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_myOption</span>

    <span class="c1"># the name in the decorator should match the name of the</span>
    <span class="c1"># property to make sure communication goes well.</span>
    <span class="nd">@myOption</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@updateOption</span><span class="p">(</span><span class="s1">&#39;myOption&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">myOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># this could include validation, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_myOption</span> <span class="o">=</span> <span class="n">value</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>That is essentially all that is needed for the Node; only the process function that does something depending on the value of <code class="docutils literal notranslate"><span class="pre">myOption</span></code> is missing here. The UI class might then look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyNodeGui</span><span class="p">(</span><span class="n">NodeWidget</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># this is a Qt requirement</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="n">somehowSetUpWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optSetters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;myOption&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMyOption</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optGetters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;myOption&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMyOption</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># often the trigger will be a valueChanged function or so,</span>
        <span class="c1"># that returns a value. Since the signalOption function</span>
        <span class="c1"># doesn&#39;t require one, we can use a lambda to bypass, if necessary.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">somethingChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalOption</span><span class="p">(</span><span class="s1">&#39;myOption&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">setMyOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">doSomething</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getMyOption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">getInfoNeeded</span><span class="p">()</span>
</pre></div>
</div>
<p>This node can then already be used, with the UI if desired, in a flowchart.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../nodes/index.html" class="btn btn-neutral float-right" title="Predefined nodes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="data.html" class="btn btn-neutral float-left" title="Data formats" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Wolfgang Pfaff, Marcos Frenkel.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>